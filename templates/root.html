<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <title>Dashboard</title>
</head>

<style>
    input[type="radio"] + label{
        width:100%;
    }

    input[type="radio"]:checked + label{
        background-color: white;
        color: black;
    }
</style>

<script>

    function loadAllInfo(){
        loadCustomerInfo()
        activate('/total')
    }

    function loadCustomerInfo() {
        var xhr = new XMLHttpRequest()
        xhr.open('GET', '/customerinfo')
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                drawCustomerInfo(xhr)
            }
        }
        xhr.send()
    }

    function drawCustomerInfo(xhr) {
        var data = xhr.responseText
        var json = JSON.parse(data)
        totalcus.innerText = json['totalcus']
        newcus.innerText = json['newcus']
        churncus.innerText = json['churncus']
        avgdur.innerText = json['avgdur']
    }

    function activate(section) {
        var xhr = new XMLHttpRequest()
        xhr.open('GET', section)
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                drawCharts(xhr)
            }
        }
        xhr.send()
    }

    function drawCharts(xhr){
        var data = xhr.responseText
        var json = JSON.parse(data)
        switch (json['name']) {
            case 'total':
                drawTotal(json['data'])
                return
            case 'phone':
                drawPhone(json['data'])
                return
            case 'internet':
                drawInternet(json['data'])
                return
        }
    }

    function drawTotal(data){
        var graphs = data['pie']
        Plotly.newPlot('pie-chart', graphs, {});
    }

    function drawPhone(data){
        var graphs = data['pie']
        Plotly.newPlot('pie-chart', graphs, {});
    }
    
    function drawInternet(data){
        var graphs = data['pie']
        Plotly.newPlot('pie-chart', graphs, {});
    }



</script>
<body class="bg-secondary" onload="loadAllInfo()">
    <div class="container rounded py-5">
        <!-- values -->
        <div id="top" class="row g-3">
            <div class="col-sm-3">
                <div class="bg-dark text-white rounded p-3">
                    <div><p class="fs-5">Total Customer</p></div>
                    <div ><p id="totalcus" class="fs-1">Loading</p></div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="bg-dark text-white rounded p-3">
                    <div><p class="fs-5">New Customer</p></div>
                    <div><p id="newcus" class="fs-1">Loading</p></div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="bg-dark text-white rounded p-3">
                    <div><p class="fs-5">Churn Customer</p></div>
                    <div><p id="churncus" class="fs-1">Loading</p></div>
                </div>
            </div>
            <div class="col-sm-3">
                <div class="bg-dark text-white rounded p-3">
                    <div><p class="fs-5">Duration</p></div>
                    <div><p id="avgdur" class="fs-1">Loading</p></div>
                </div>
            </div>
        </div>

        <!-- graph -->
        <div class="mt-5" style="height:600px">
            <div class="bg-dark text-white rounded px-5 py-5" style="height:100%">
                <!-- <p class="row fs-5 text-white mb-0">sss</p> -->
                <div class="row" style="height:100%">
                    <div class="col-sm-2">
                        <div class="row">
                            <input id="section-total" type="radio" name="section" value="total" style="appearance:none" checked>
                            <label for="section-total" class="pt-3 pl-3 pb-3" onclick="activate('/total')">
                                <span>Total</span>
                            </label>
                        </div>
                        <div class="row">
                            <input id="section-phone" type="radio" name="section" value="phone" style="appearance:none" >
                            <label for="section-phone"  class="pt-3 pl-3 pb-3" onclick="activate('/phone')">
                                <span>Phone</span>
                            </label>
                        </div>
                        <div class="row">
                            <input id="section-internet" type="radio" name="section" value="internet" style="appearance:none">
                            <label for="section-internet" class="pt-3 pl-3 pb-3" onclick="activate('/internet')">
                                <span>Internet</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- inner graph -->
                    <div class="col-sm-10 h-100">
                        <div id='first-graph-row' class="row bg-white text-black h-100 px-0">
                            <div id="pie-chart" class="col-3 bg-black h-100 px-0"></div>
                            <div id="pie-chart" class="col-3 bg-black h-100 px-0"></div>
                            <div id="pie-chart" class="col-3 bg-black h-100 px-0"></div>
                            <div id="pie-chart" class="col-3 bg-black h-100 px-0"></div>
                        </div>
                        <div id='second-graph-row'  class="row bg-white text-black h-0">
                            <div id="second-pie-chart" class="col-3 bg-black h-100 px-0"></div>
                            <div id="second-pie-chart" class="col-3 bg-black h-100 px-0"></div>
                            <div id="second-pie-chart" class="col-3 bg-black h-100 px-0"></div>
                            <div id="second-pie-chart" class="col-3 bg-black h-100 px-0"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>